<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aztec Hall — Community Shout‑outs</title>
  <link rel="icon" type="image/svg+xml"
    href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><rect width="64" height="64" rx="12" fill="%236f6ce8"/><rect x="18" y="18" width="28" height="28" rx="6" fill="%23ffffff"/></svg>'>
  <meta name="description" content="Community shout‑outs and roles for the Aztec ecosystem." />
  <style>
    /* ==== Dark Aztec theme to match Meme Gallery / Wall ==== */
    :root{
      --bg0:#0b0f16; --bg1:#101628; --ink:#e7eaff; --muted:#97a0c9; --brand:#6f6ce8;
      --card:#121b32; --card2:#0c1429; --ring:#22305d; --chip:#0f1a39; --chip-ring:#1d2952;
      --shadow:0 10px 26px rgba(0,0,0,.35);

      /* role colors (used to tint chips lightly) */
      --role-Homestaker-Sentinel:#a17600;
      --role-High-Attester:#a3e635;
      --role-Proposal-Commander:#214168;
      --role-Meme-Lord:#7c79ff;
      --role-Content-Chronicler:#22c55e;
      --role-Queue-Master:#7F00FF;
      --role-The-Paragon:#f472b6;
      --role-The-Archivist:#06b6d4;
      --role-Maestro:#a401b6;
      --role-Explorer:#ef4444;
      --role-Initiated:#c084fc;
      --role-Tester:#fb923c;
      --role-Town-Hall-Warrior:#64748b;
      --role-Defender:#16a34a;
      --role-Developer:#60a5fa;

      --role-1:#6d28d9; --role-2:#0891b2; --role-3:#16a34a; --role-4:#f59e0b; --role-5:#ef4444; --role-6:#9333ea;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--ink);
      font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;
      background:
        radial-gradient(1100px 700px at 0% -20%, #132242 0%, var(--bg0) 45%),
        radial-gradient(900px 600px at 120% 120%, #1a2450 0%, transparent 60%),
        var(--bg0);
    }

    /* Header (matches gallery) */
    .bar{position:sticky; top:0; z-index:10; backdrop-filter:blur(6px); background:rgba(11,15,22,.65); border-bottom:1px solid #0e1530}
    .bar .wrap{display:flex; align-items:center; gap:14px; padding:18px; max-width:1280px; margin:0 auto}
    .brand{width:60px; height:60px; border-radius:12px; display:grid; place-items:center; background:var(--brand); box-shadow:inset 0 0 0 2px #ffffff22}
    .brand svg{width:70%; height:70%}
    .title{
      font-weight:900; letter-spacing:.2px; font-size:38px; line-height:1;
      background:linear-gradient(90deg,#8e2de2,#4a00e0); -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    .muted{color:var(--muted); font-size:16px}

    .main{max-width:1200px; margin:0 auto; padding:18px 16px 90px}

    /* Controls (dark pills) */
    .controlsWrap{max-width:900px; margin:0 auto 16px}
    .controls{
      display:grid; grid-template-columns:1fr 220px; gap:12px; align-items:center;
    }
    .field{display:grid; gap:6px}
    label{font-size:14px; color:#9fa7ff; font-weight:900}
    .controls input, .controls select{
      height:48px; font-size:15px; padding:0 12px; border-radius:12px; outline:none; width:100%;
      background:#0f1a39; color:#e7eaff; border:1px solid #1d2952;
    }
    .controls select{
      -webkit-appearance:none; appearance:none; padding-right:34px;
      background-image:url("data:image/svg+xml,%3Csvg width='12' height='12' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4l4 4 4-4' stroke='%236f6ce8' stroke-width='2' fill='none'/%3E%3C/svg%3E");
      background-repeat:no-repeat; background-position:right 10px center; background-size:12px;
    }
    @media (max-width:640px){
      .controls{grid-template-columns:1fr 1fr}
      .controls input,.controls select{font-size:14px; padding:0 10px}
    }

    /* ==== Pinterest Masonry ==== */
    .grid{
      column-count:1; column-gap:14px; margin-top:10px;
    }
    @media (min-width:640px){ .grid{ column-count:2 } }
    @media (min-width:900px){ .grid{ column-count:3 } }
    @media (min-width:1200px){ .grid{ column-count:4 } }

    .card{
      display:inline-block; width:100%;
      background:linear-gradient(180deg,var(--card),var(--card2));
      border:1px solid var(--ring);
      border-radius:16px; overflow:hidden;
      box-shadow:var(--shadow);
      margin:0 0 14px; break-inside:avoid;
      transition:transform .16s ease, box-shadow .16s ease;
    }
    .card:hover{ transform:translateY(-2px); box-shadow:0 14px 36px rgba(0,0,0,.4) }

    .pfpWrap{ background:#0b1124; border-bottom:1px solid var(--ring) }
    .pfp{ width:100%; height:100% }
    .pfp img{ width:100%; height:auto; display:block }

    .body{ padding:10px 10px 12px; display:flex; flex-direction:column; gap:8px }
    .topRow{display:flex; align-items:center; gap:8px; justify-content:space-between}
    .rank{
      display:inline-flex; align-items:center; justify-content:center;
      min-width:34px; height:24px; padding:0 8px; font-weight:900;
      border-radius:999px; background:#0f1a39; color:#cfd6ff; border:1px solid #2a3a6a; font-size:13px
    }
    .name{ font-weight:900; font-size:16px; color:#e7eaff; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }

    .rolesWrap{ background:#0c1429; border:1px solid var(--ring); border-radius:12px; padding:8px }
    .roles{ display:flex; gap:6px; flex-wrap:wrap }
    .role{
      font-weight:800; padding:5px 8px; border-radius:999px; font-size:12px;
      border:1px solid var(--chip-ring); background:var(--chip); color:#dbe0ff;
      box-shadow: inset 0 -2px 4px rgba(0,0,0,.12)
    }

    .empty{ color:#c8cff9; text-align:center; padding:18px; font-size:.95rem }

    /* Skeletons for dark bg */
    .skeleton{ display:inline-block; width:100%; margin:0 0 14px; break-inside:avoid;
      border-radius:16px; border:1px solid var(--ring); background:linear-gradient(180deg,#111a32,#0c1429); box-shadow:var(--shadow); overflow:hidden }
    .sk-img{ height:220px; background:linear-gradient(90deg,#0e1730 25%,#122043 37%,#0e1730 63%); background-size:400% 100%; animation: shimmer 1.2s infinite }
    .sk-body{ padding:12px }
    .sk-line{ height:14px; border-radius:6px; margin:8px 0; background:linear-gradient(90deg,#0e1730 25%,#122043 37%,#0e1730 63%); background-size:400% 100%; animation: shimmer 1.2s infinite }
    @keyframes shimmer { 0%{background-position:100% 0} 100%{background-position:-100% 0} }

    /* Notice board styled for dark */
    .notice{max-width:1200px; margin:10px auto 22px; padding:0 16px}
    .notice .board{background:linear-gradient(180deg,var(--card),var(--card2)); border:1px solid var(--ring); border-radius:14px; box-shadow:var(--shadow); padding:16px}
    .notice h3{margin:0 0 8px 0; font-size:22px; color:#cfd6ff; letter-spacing:.2px; font-weight:900}
    .notice p{margin:6px 0 10px; color:#bec6ff; font-size:15px; font-weight:600}
    .notice ul{margin:0; padding-left:18px; line-height:1.6; color:#e7eaff; font-size:15px}

    .credit{
      position:fixed;bottom:12px;left:50%;transform:translateX(-50%);
      background:#101632;color:#cfd6ff;border:1px solid #22305d;
      padding:7px 10px;border-radius:999px;font-size:12px;font-weight:800;text-decoration:none;box-shadow:0 6px 18px rgba(0,0,0,.35)
    }
  </style>
</head>
<body>
  <header class="bar">
    <div class="wrap">
      <div class="brand" title="Aztec">
        <svg viewBox="0 0 100 100" fill="none" aria-hidden="true">
          <rect width="100" height="100" rx="22" fill="#ffffff22"/>
          <rect x="20" y="20" width="60" height="60" rx="12" fill="#6f6ce8"/>
          <rect x="35" y="35" width="30" height="30" rx="8" fill="#ffffff"/>
        </svg>
      </div>
      <div>
        <div class="title">Aztec Hall</div>
        <div class="muted">Community shout‑outs and roles</div>
      </div>
      <div style="flex:1"></div>
    </div>
  </header>

  <!-- notice board -->
  <section class="notice">
    <div class="board">
      <h3>Notice board</h3>
      <p style="color:#ffd294; font-weight:700">The table is updated weekly after Community TownHall.</p>
      <p><strong>To be listed here, you must have at least one of these roles:</strong></p>
      <ul>
        <li>Homestaker Sentinel</li>
        <li>High Attester</li>
        <li>Proposer commander</li>
        <li>Content chronicler</li>
        <li>Queue Master</li>
        <li>Maestro</li>
        <li>The Paragon</li>
        <li>The Archivist</li>
      </ul>
    </div>
  </section>

  <main class="main">
    <!-- controls -->
    <section class="controlsWrap">
      <div class="controls">
        <div class="field">
          <label for="q">Search</label>
          <input id="q" type="search" placeholder="Search name or handle…" />
        </div>
        <div class="field">
          <label for="roleSel">Filter by role</label>
          <select id="roleSel"><option value="">All roles</option></select>
        </div>
      </div>
    </section>

    <!-- Masonry column container -->
    <section id="cards" class="grid"></section>
  </main>

  <a class="credit" href="https://x.com/seuncoded" target="_blank" rel="noopener">Built by @seuncoded</a>

  <script>
    /* === Data plumbing unchanged; minor robustness tweaks remain === */

    // Case-insensitive required roles
    const REQUIRED_ROLES = [
      'Homestaker Sentinel','High Attester','Proposer commander','Proposal Commander',
      'Content Chronicler','Content chronicler','Queue Master','Maestro','The Paragon','The Archivist'
    ];
    const REQUIRED_LOWER = new Set(REQUIRED_ROLES.map(r => r.toLowerCase()));

    const SHEET_JSON_URL = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLhUaagfckU5EY06gOWlMtrOxN0YE9i5UR9cLCrdFD0CFmhI7hmMKaw9liDmiWCYXZRLaI4J-WNcinmeMqb0b-61ti2FFT2D4SKbKLhfgeOhstt1cmI4qncEVq9XUgJihONg6PPZUht3Nuy25j_ln4PbdaY5c8-sqW7X5S0fauIfcpxou13f-XjT_etQcY2UvZMxq5mRnRhSRJJFtfdjcXSYYFbKNXxbAPBOFCPy-ZcMJJu-0icqWOCsO_kwOnCfr8SXm5L5y2w4o__wIZdX6vAFmfDLPHDc6qM3c5N5&lib=MmoffGhvRFJSfNRmoE_Umb04A79LrDTNZ";
    const API_URL = (location.hostname === "localhost" || location.hostname === "127.0.0.1")
      ? SHEET_JSON_URL : "/api/contributors";

    const el = s => document.querySelector(s);
    const state = { all:[], filtered:[], search:'', role:'' };

    function renderSkeletons(n=8){
      const card = () => `
        <div class="skeleton">
          <div class="sk-img"></div>
          <div class="sk-body">
            <div class="sk-line" style="width:70%"></div>
            <div class="sk-line" style="width:40%"></div>
            <div class="sk-line" style="width:90%"></div>
          </div>
        </div>`;
      el('#cards').innerHTML = Array.from({length:n}, card).join('');
    }

    async function loadData(){
      const res = await fetch(API_URL, { cache:'no-store' });
      if(!res.ok) throw new Error('Failed to load /api/contributors');
      const raw = await res.json();
      return (Array.isArray(raw)?raw:[]).map(item=>{
        const roles = Array.isArray(item.roles)
          ? item.roles
          : String(item.roles||'').split('|').map(s=>s.trim()).filter(Boolean);
        return {
          id:item.id||'', name:item.name||'', handle:item.handle||'',
          twitterUrl:item.twitterUrl||'', pfp:item.pfp||item.localPfp||'', roles
        };
      });
    }

    // role color map (case-insensitive)
    const css = getComputedStyle(document.documentElement);
    const exactColorMap = new Map([
      ['Homestaker Sentinel', css.getPropertyValue('--role-Homestaker-Sentinel')],
      ['High Attester', css.getPropertyValue('--role-High-Attester')],
      ['Proposal Commander', css.getPropertyValue('--role-Proposal-Commander')],
      ['Proposer commander', css.getPropertyValue('--role-Proposal-Commander')],
      ['Meme Lord', css.getPropertyValue('--role-Meme-Lord')],
      ['Content Chronicler', css.getPropertyValue('--role-Content-Chronicler')],
      ['Content chronicler', css.getPropertyValue('--role-Content-Chronicler')],
      ['Queue Master', css.getPropertyValue('--role-Queue-Master')],
      ['The Paragon', css.getPropertyValue('--role-The-Paragon')],
      ['The Archivist', css.getPropertyValue('--role-The-Archivist')],
      ['Maestro', css.getPropertyValue('--role-Maestro')],
      ['Explorer', css.getPropertyValue('--role-Explorer')],
      ['Initiated', css.getPropertyValue('--role-Initiated')],
      ['Tester', css.getPropertyValue('--role-Tester')],
      ['Tester Role', css.getPropertyValue('--role-Tester')],
      ['Town Hall Warrior', css.getPropertyValue('--role-Town-Hall-Warrior')],
      ['Town hall Warrior', css.getPropertyValue('--role-Town-Hall-Warrior')],
      ['Defender', css.getPropertyValue('--role-Defender')],
      ['Developer', css.getPropertyValue('--role-Developer')],
    ]);
    const lowerColorMap = new Map([...exactColorMap.entries()].map(([k,v])=>[k.toLowerCase(), v]));
    const fallback = ['--role-1','--role-2','--role-3','--role-4','--role-5','--role-6'].map(v=>css.getPropertyValue(v));

    const pill = (role,i)=>{
      const col = (lowerColorMap.get(String(role).toLowerCase()) || fallback[i%fallback.length]).trim() || '#6f6ce8';
      const bg = `${col}30`;  // translucent
      const br = `${col}70`;
      return `<span class="role" style="background:${bg}; border-color:${br}">${escapeHtml(role)}</span>`;
    };

    function applyFiltersAndRank(){
      const q = state.search.toLowerCase();
      let arr = state.all.map(p => ({ ...p, roles:(p.roles||[]) }));
      arr = arr.filter(p => (p.roles||[]).some(r => REQUIRED_LOWER.has(String(r).toLowerCase())));

      if(q){ arr = arr.filter(x =>
        (x.name||'').toLowerCase().includes(q) ||
        (x.handle||'').toLowerCase().includes(q)
      );}

      if(state.role){ arr = arr.filter(x => (x.roles||[]).map(r=>String(r).toLowerCase()).includes(state.role.toLowerCase())); }

      arr.sort((a,b)=>{
        const da=(a.roles||[]).length, db=(b.roles||[]).length;
        return db - da || (a.name||'').localeCompare(b.name||'');
      });

      arr.forEach((p, idx) => { p.rank = idx + 1; p.roleCount = (p.roles||[]).length; });
      state.filtered = arr;
    }

    function avatarHtml(p){
      const img = p.pfp
        ? `<img src="${p.pfp}" alt="${escapeHtml(p.name||'')}" loading="lazy" decoding="async">`
        : `<div class="pfp" style="display:grid;place-items:center;background:#0f1a39;color:#9fa7ff;font-weight:900;font-size:42px">${(p.name||'?')[0]||'?'}</div>`;
      return `<div class="pfp">${img}</div>`;
    }

    function cardHtml(p){
      const roles = (p.roles||[]).map((r,i)=> pill(r,i)).join('');
      const hrefAttr = p.twitterUrl ? ` data-href="${p.twitterUrl}"` : '';
      return `
        <article class="card"${hrefAttr} data-id="${escapeHtml(p.id)}">
          <div class="pfpWrap">${avatarHtml(p)}</div>
          <div class="body">
            <div class="topRow">
              <div class="name">${escapeHtml(p.name||'')}</div>
              <span class="rank">#${p.rank}</span>
            </div>
            <div class="rolesWrap"><div class="roles">${roles}</div></div>
          </div>
        </article>`;
    }

    function render(){
      applyFiltersAndRank();
      const box = el('#cards');
      if(!state.filtered.length){
        box.innerHTML = `<div class="empty">No matches. Try clearing filters.</div>`;
        rebuildRoleFilterFromVisible();
        return;
      }
      box.innerHTML = state.filtered.map(cardHtml).join('');
      rebuildRoleFilterFromVisible();
    }

    function rebuildRoleFilterFromVisible(){
      const roleSel = document.querySelector('#roleSel');
      const prev = roleSel.value;
      const visibleRoles = Array.from(new Set(state.filtered.flatMap(x => x.roles || []))).sort((a,b)=>a.localeCompare(b));
      roleSel.innerHTML = '<option value="">All roles</option>' + visibleRoles.map(r=>`<option value="${r}">${r}</option>`).join('');
      if (prev && visibleRoles.includes(prev)) roleSel.value = prev; else state.role = '';
    }

    document.addEventListener('click', (e)=>{
      const card = e.target.closest('.card[data-href]');
      if(!card) return;
      const url = card.getAttribute('data-href');
      if(url) window.open(url, '_blank', 'noopener');
    });
    function escapeHtml(s){ return String(s).replace(/[&<>]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[m])); }
    el('#q').addEventListener('input', (e)=>{ state.search = e.target.value; render(); });
    document.querySelector('#roleSel').addEventListener('change', (e)=>{ state.role = e.target.value; render(); });

    (async function init(){
      renderSkeletons(8);
      try{
        state.all = await loadData();
        render();
      }catch(e){
        el('#cards').innerHTML = `<div class="empty">Failed to load. Refresh to try again.</div>`;
      }
    })();
  </script>
</body>
</html>